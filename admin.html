<script>
  const PASSWORD = "0000";
  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxdkS8qxjx2EcZayyE2WDTPlZskq6qYBu0ScDTlI_EVjnqRV9UMewkUm8R0diAuFop5/exec";

  function login() {
    if (document.getElementById('password').value === PASSWORD) {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('content').classList.remove('hidden');
      loadData();
    } else {
      document.getElementById('error').style.display = 'block';
    }
  }

  async function loadData() {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL + "?t=" + Date.now());
      const records = await response.json();
      
      const grouped = {};
      records.forEach(r => {
        const date = r["Дата"];
        if (!grouped[date]) grouped[date] = [];
        grouped[date].push(r);
      });

      let total = 0;
      let html = '';
      const dates = Object.keys(grouped).sort();
      const nextDate = dates[0] || '—';
      const nextCount = grouped[nextDate]?.length || 0;

      dates.forEach(date => {
        const list = grouped[date];
        total += list.length;
        html += `<div style="margin:30px 0;">
          <h3>${date} — ${list.length}/20 мест</h3>
          <table><thead><tr><th>№</th><th>Студент</th><th>Родитель</th><th>Группа</th><th>Телефон</th><th>Время</th></tr></thead><tbody>`;
        list.forEach((r, i) => {
          html += `<tr>
            <td>${i+1}</td>
            <td>${r["Студент"] || ''}</td>
            <td>${r["Родитель"] || ''}</td>
            <td>${r["Группа"] || ''}</td>
            <td>${r["Телефон"] || ''}</td>
            <td>${r["Время записи"] || ''}</td>
          </tr>`;
        });
        html += `</tbody></table></div>`;
      });

      document.getElementById('total').textContent = total;
      document.getElementById('next').textContent = nextDate;
      document.getElementById('left').textContent = 20 - nextCount;
      document.getElementById('records').innerHTML = html || '<p>Записей нет</p>';
    } catch (e) {
      document.getElementById('records').innerHTML = '<p>Ошибка загрузки</p>';
    }
  }
</script>
